{{left_sidebar_enabled,right_sidebar_enabled=False,('message' in globals())}}
{{extend 'layout.html'}}

{{if 'message' in globals():}}
<h3>{{=message}}</h3>
<form>
    <table border=0>
        <tr>
        <td valign="top"><svg style="width: 1024; height: 768;"></svg></td>
        </tr>
    </table>
    <br/>
</form>

<script>

var diameter = 960,
    format = d3.format(",d"),
    color = d3.scale.category20c();

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.5);

// selects the existing svg object in the page
var svg = d3.select("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");

// var svg = d3.select("body").append("svg")
//     .attr("width", diameter)
//     .attr("height", diameter)
//     .attr("class", "bubble");

// gets the JSON object miserable from the server side
var root = {{=XML(response.json(bubbledata))}};


var node = svg.selectAll(".node")
  .data(bubble.nodes(classes(root))
  .filter(function(d) { return !d.children; }))
.enter().append("g")
  .attr("class", "node")
  .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

node.append("title")
  .style('font-size', 10)
  .text(function(d) { return d.className + ": " + format(d.value); });

node.append("circle")
  .attr("r", function(d) { return d.r; })
  .style("fill", function(d) { return color(d.packageName); });

node.append("text")
  .attr("dy", ".3em")
  .style("text-anchor", "middle")
  .style('font', "10px sans-serif;")
  .text(function(d) { return d.className.substring(0, d.r / 3); });


// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size});
  }

  recurse(null, root);
  return {children: classes};
}

d3.select(self.frameElement).style("height", diameter + "px");

</script>



Page title: {{=pagetitle}}

Page path: {{=pagepath}}

Page counts: {{=doc}}

{{elif 'content' in globals():}}
{{=content}}
{{else:}}
{{=BEAUTIFY(response._vars)}}
{{pass}}

{{block right_sidebar}}
{{=A(T("Administrative Interface"), _href=URL('admin','default','index'), _class='btn', _style='margin-top: 1em;')}}
<h6>{{=T("Useful Links")}}</h6>
<ul>
  <li><a href="http://www.law.ufl.edu/academics/institutes/icair">UF Law E-Discovery Project</a></li>
  <li><a href="http://dsr.cise.ufl.edu">Data Science Research (DSR) Lab</a></li>
</ul>
{{end}}
